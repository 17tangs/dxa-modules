import com.sdl.dxa.builder.maven.MavenBuildTask
import com.sdl.dxa.builder.maven.MavenHelpTask

buildscript {
    repositories {
        mavenLocal()
    }
    //noinspection GroovyAssignabilityCheck
    dependencies {
        classpath group: 'com.sdl.dxa', name: 'dxa-builder', version: version
    }
}

defaultTasks 'buildModules'

task wrapper(type: Wrapper) {
    gradleVersion = '2.9'
    distributionUrl = "https://services.gradle.org/distributions/gradle-$gradleVersion-all.zip"
}

task help(type: MavenHelpTask)

task buildModules(type: MavenBuildTask) {
    configurations = [
            ["dxa-module-smarttarget-abstract"],
            [
                    "dxa-module-cid",
                    "dxa-module-core",
                    "dxa-module-googleanalytics",
                    "dxa-module-mediamanager",
                    "dxa-module-search",
                    "dxa-module-51degrees",
                    "dxa-module-context-expressions",
                    "dxa-module-test",
                    "dxa-module-smarttarget-2013sp1",
                    "dxa-module-smarttarget-web8"
            ]
    ]

    if (project.hasProperty('command')) {
        command = project.command
    }

    verbose = project.hasProperty('verbose')

    if (project.hasProperty('mavenProperties')) {
        mavenProperties = project.mavenProperties
    }
}

task localRepoDxa(dependsOn: buildModules, type: MavenBuildTask) {
    def commonPart = "install:install-file -DgroupId=com.sdl.dxa.modules -Dversion=${version} -DlocalRepositoryPath=${projectDir}/local-project-repo"
    def jar = { String artifact ->
        "-Dfile=${artifact}/target/${artifact}-${version}.jar -DartifactId=${artifact} -Dpackaging=jar"
    }
    configurations = [
            [
                    ">> ${commonPart} ${jar('dxa-module-cid')}",
                    ">> ${commonPart} ${jar('dxa-module-core')}",
                    ">> ${commonPart} ${jar('dxa-module-googleanalytics')}",
                    ">> ${commonPart} ${jar('dxa-module-mediamanager')}",
                    ">> ${commonPart} ${jar('dxa-module-search')}",
                    ">> ${commonPart} ${jar('dxa-module-51degrees')}",
                    ">> ${commonPart} ${jar('dxa-module-context-expressions')}",
                    ">> ${commonPart} ${jar('dxa-module-googleanalytics')}",
                    ">> ${commonPart} ${jar('dxa-module-test')}",
                    ">> ${commonPart} ${jar('dxa-module-smarttarget-2013sp1')}",
                    ">> ${commonPart} ${jar('dxa-module-smarttarget-web8')}",
            ]
    ]
    verbose = project.hasProperty('verbose')
}